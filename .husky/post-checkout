#!/bin/sh

# SPDX-License-Identifier: MIT

. "$(dirname "$0")/_/husky.sh"

if [ $3 -ne 1 ]; then
  exit 0
fi

function die(){
  local STATUS=$?
  echo $1 >&2
  exit $STATUS
}

if !(type gh > /dev/null 2>&1); then
  exit 0
fi

BRANCH=$(git rev-parse --abbrev-ref HEAD)

if [[ "${BRANCH}" =~ ^(HEAD|main|develop)$ ]]; then
  exit 0
fi

ISSUES=$(echo "${BRANCH}" | grep -oE '#[0-9]+' | tr -d '#' | sort -nr || :)

if [[ ! ${ISSUES[@]} ]]; then
  die "ğŸ’¡ issue ãŒé€£æºã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"
fi

for issue in $ISSUES; do
  gh --repo uchikoshi-fes/uchikoshi-fes.jp-2022 issue view $issue || die "ğŸš¨ issue $issue ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚[uchikoshi-fes/uchikoshi-fes.jp-2022]"
done
